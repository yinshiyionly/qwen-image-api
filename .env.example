# Qwen Image API Service 环境变量配置示例
# 复制此文件为 .env 并根据需要修改配置

# =============================================================================
# 模型配置 (Model Configuration)
# =============================================================================

# 模型文件路径，留空使用模拟实现
QWEN_MODEL_MODEL_PATH=

# 推理设备: cpu, cuda, cuda:0, cuda:1 等
QWEN_MODEL_DEVICE=cpu

# 数据类型: float16, float32, bfloat16
QWEN_MODEL_TORCH_DTYPE=float32

# 最大内存限制，例如 "8GB", "4096MB" 或留空（无限制）
QWEN_MODEL_MAX_MEMORY=

# 模型加载超时时间（秒）
QWEN_MODEL_LOAD_TIMEOUT=300

# 是否启用模型优化
QWEN_MODEL_ENABLE_OPTIMIZATION=false

# =============================================================================
# 服务器配置 (Server Configuration)
# =============================================================================

# 监听地址
QWEN_SERVER_HOST=0.0.0.0

# 监听端口
QWEN_SERVER_PORT=8000

# 最大文件上传大小（字节）
QWEN_SERVER_MAX_FILE_SIZE=10485760

# 最大并发请求数
QWEN_SERVER_MAX_CONCURRENT_REQUESTS=4

# 请求超时时间（秒）
QWEN_SERVER_REQUEST_TIMEOUT=300

# 是否启用 CORS
QWEN_SERVER_ENABLE_CORS=true

# 允许的 CORS 源，多个用逗号分隔
QWEN_SERVER_CORS_ORIGINS=*

# 工作进程数（仅在生产环境使用）
QWEN_SERVER_WORKERS=1

# =============================================================================
# 图像生成配置 (Generation Configuration)
# =============================================================================

# 默认图像尺寸
QWEN_GENERATION_DEFAULT_WIDTH=512
QWEN_GENERATION_DEFAULT_HEIGHT=512

# 尺寸限制
QWEN_GENERATION_MIN_SIZE=256
QWEN_GENERATION_MAX_SIZE=2048

# 默认推理步数
QWEN_GENERATION_DEFAULT_STEPS=20

# 步数限制
QWEN_GENERATION_MIN_STEPS=1
QWEN_GENERATION_MAX_STEPS=100

# 默认引导强度
QWEN_GENERATION_DEFAULT_GUIDANCE_SCALE=7.5

# 引导强度限制
QWEN_GENERATION_MIN_GUIDANCE_SCALE=1.0
QWEN_GENERATION_MAX_GUIDANCE_SCALE=20.0

# 图生图默认强度
QWEN_GENERATION_DEFAULT_STRENGTH=0.8

# 输出格式
QWEN_GENERATION_OUTPUT_FORMAT=png

# 输出质量（1-100，仅对 JPEG 有效）
QWEN_GENERATION_OUTPUT_QUALITY=95

# =============================================================================
# 安全配置 (Security Configuration)
# =============================================================================

# 是否启用速率限制
QWEN_SECURITY_ENABLE_RATE_LIMIT=true

# 每分钟最大请求数
QWEN_SECURITY_RATE_LIMIT_PER_MINUTE=60

# 是否验证文件类型
QWEN_SECURITY_VALIDATE_FILE_TYPE=true

# 是否扫描恶意内容
QWEN_SECURITY_SCAN_MALICIOUS_CONTENT=false

# API 密钥（如果设置，则需要在请求头中包含 X-API-Key）
QWEN_SECURITY_API_KEY=

# =============================================================================
# 日志配置 (Logging Configuration)
# =============================================================================

# 日志级别: DEBUG, INFO, WARNING, ERROR, CRITICAL
QWEN_LOG_LEVEL=INFO

# 日志格式
QWEN_LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s

# 日志文件路径，留空表示只输出到控制台
QWEN_LOG_FILE_PATH=

# 日志文件最大大小（字节）
QWEN_LOG_MAX_FILE_SIZE=10485760

# 保留的日志文件数量
QWEN_LOG_BACKUP_COUNT=5

# 是否记录请求详情
QWEN_LOG_LOG_REQUESTS=true

# 是否记录响应详情
QWEN_LOG_LOG_RESPONSES=false

# =============================================================================
# 缓存配置 (Cache Configuration)
# =============================================================================

# 是否启用缓存
QWEN_CACHE_ENABLED=false

# 缓存类型: memory, redis
QWEN_CACHE_TYPE=memory

# 缓存过期时间（秒）
QWEN_CACHE_TTL=3600

# 最大缓存条目数
QWEN_CACHE_MAX_ENTRIES=1000

# Redis 配置（当 type 为 redis 时使用）
QWEN_CACHE_REDIS_HOST=localhost
QWEN_CACHE_REDIS_PORT=6379
QWEN_CACHE_REDIS_DB=0
QWEN_CACHE_REDIS_PASSWORD=

# =============================================================================
# 监控配置 (Monitoring Configuration)
# =============================================================================

# 是否启用指标收集
QWEN_MONITORING_ENABLED=true

# 指标端点路径
QWEN_MONITORING_METRICS_PATH=/metrics

# 是否启用健康检查
QWEN_MONITORING_HEALTH_CHECK=true

# 健康检查端点路径
QWEN_MONITORING_HEALTH_PATH=/health

# 是否收集详细指标
QWEN_MONITORING_DETAILED_METRICS=false

# =============================================================================
# 开发配置 (Development Configuration)
# =============================================================================

# 是否启用调试模式
QWEN_DEVELOPMENT_DEBUG=false

# 是否启用自动重载
QWEN_DEVELOPMENT_AUTO_RELOAD=false

# 是否启用 API 文档
QWEN_DEVELOPMENT_ENABLE_DOCS=true

# API 文档路径
QWEN_DEVELOPMENT_DOCS_URL=/docs

# OpenAPI 规范路径
QWEN_DEVELOPMENT_OPENAPI_URL=/openapi.json

# =============================================================================
# 生产环境示例配置
# =============================================================================

# 取消注释以下配置用于生产环境部署

# 模型配置
# QWEN_MODEL_MODEL_PATH=/app/models/qwen-image
# QWEN_MODEL_DEVICE=cuda
# QWEN_MODEL_TORCH_DTYPE=float16
# QWEN_MODEL_MAX_MEMORY=6GB
# QWEN_MODEL_ENABLE_OPTIMIZATION=true

# 服务器配置
# QWEN_SERVER_MAX_CONCURRENT_REQUESTS=8
# QWEN_SERVER_WORKERS=2
# QWEN_SERVER_CORS_ORIGINS=https://yourdomain.com,https://api.yourdomain.com

# 安全配置
# QWEN_SECURITY_API_KEY=your-secret-api-key-here
# QWEN_SECURITY_RATE_LIMIT_PER_MINUTE=120
# QWEN_SECURITY_VALIDATE_FILE_TYPE=true
# QWEN_SECURITY_SCAN_MALICIOUS_CONTENT=true

# 日志配置
# QWEN_LOG_LEVEL=WARNING
# QWEN_LOG_FILE_PATH=/app/logs/qwen-api.log
# QWEN_LOG_LOG_REQUESTS=false

# 缓存配置
# QWEN_CACHE_ENABLED=true
# QWEN_CACHE_TYPE=redis
# QWEN_CACHE_REDIS_HOST=redis
# QWEN_CACHE_TTL=7200

# 监控配置
# QWEN_MONITORING_DETAILED_METRICS=true

# 开发配置
# QWEN_DEVELOPMENT_DEBUG=false
# QWEN_DEVELOPMENT_ENABLE_DOCS=false

# =============================================================================
# Docker 相关环境变量
# =============================================================================

# Docker Compose 项目名称
COMPOSE_PROJECT_NAME=qwen-image-api

# Docker 镜像标签
IMAGE_TAG=latest

# =============================================================================
# 外部服务配置
# =============================================================================

# Redis 连接（如果使用外部 Redis）
# REDIS_URL=redis://localhost:6379/0

# 数据库连接（如果需要）
# DATABASE_URL=postgresql://user:password@localhost:5432/dbname

# =============================================================================
# 使用说明
# =============================================================================

# 1. 复制此文件为 .env:
#    cp .env.example .env
#
# 2. 根据你的环境修改相应的配置值
#
# 3. 重启服务使配置生效:
#    docker-compose restart
#
# 4. 验证配置是否生效:
#    curl http://localhost:8000/info
#
# 注意事项:
# - 生产环境务必设置 API_KEY
# - GPU 环境需要安装 NVIDIA Docker
# - 确保模型文件路径正确
# - 根据硬件资源调整并发数和内存限制